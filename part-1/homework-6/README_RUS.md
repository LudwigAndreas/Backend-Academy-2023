# Tinkoff Backend Academy homework 6

Проект электронных очередей

## Contents

1. [Information](#information)
2. [Part 1](#part-1-implementation)
3. [Part 2. Bonus](#part-2-bonus)

## Information

**Название проекта:** Домашнее задание Tinkoff Backend Academy 6 - Проект электронных очередей

**Описание:**

Проект электронных очередей представляет собой программу, которая позволяет пользователям создавать задачи, добавлять их в очередь, обрабатывать их и завершать. Программа предоставляет REST API для взаимодействия с пользователями и менеджерами.

**Используемые технологии:**

- **Язык программирования:** Java 17
- **Инструменты разработки:** IntelliJ IDEA, Gradle, Spring Framework
- **Контроль версий:** Git

**Ключевые особенности:**

- **Создание задачи:** Метод принимает на вход данные задачи и добавляет ее в очередь. Метод возвращает номер задачи.
- **Получение следующей задачи:** Метод возвращает следующую задачу из очереди для обработки.
- **Получение всех существующих задач:** Метод возвращает все задачи, разбитые по статусам.
- **Получение задачи по номеру:** Метод возвращает задачу по номеру задачи.
- **Изменение статуса задачи:** Метод изменяет статус задачи по номеру задачи.
- **Удаление задачи:** Метод удаляет задачу по номеру задачи.
- **Получение среднего времени обработки задач:** Метод возвращает среднее время обработки задач.
- **Получение времени обработки задачи:** Метод возвращает время обработки задачи по номеру задачи.
- **Получение времени обработки задач по статусу:** Метод возвращает время обработки задач по статусу.

**Детали реализации:**

- **Статусы задач:**
  - NEW
  - WAITING
  - PROCESSED
  - CLOSE
  - CANCEL
- **Очередь задач:** Для реализации очереди задач используется `ConcurrentLinkedQueue`.
- **Номер задачи:** Уникальная строка из нескольких цифр и букв.
- **Проверка задач:** Задачи, находящиеся в статусе, отличном от `NEW`, дольше 30 минут при проверке раз в минуту по cron переходят в статус `CANCEL`.

**Инструкции по использованию:**

1. Запустите приложение, запустив основной класс.
2. Используйте HTTP-клиент для отправки запросов в приложение.
3. Отправьте POST запрос для создания задачи на перенос товаров из одной категории в другую.
4. Отправьте GET запрос для получения статуса задачи.

**Цели проекта:**

- Реализовать программу для создания, добавления, обработки и завершения задач.
- Реализовать REST API для взаимодействия с программой.
- Обеспечить покрытие тестами выше 90%.
- Изучить и использовать mapStruct, Swagger и Lombok.
- Реализовать контракт first с помощью Swagger.
- Реализовать SOAP сервис.
- Реализовать gRPC.
- Реализовать SecurityFilterChain с доступом к endpoint-ами на создание и получение списка задач в очереди `permitAll`, а к остальным по ролям `manager`, `user` с паролем и логином, хранящимся в `application.properties` или переменной окружения.
- Покрыть тестами поведение SecurityFilterChain.
- Реализовать Swagger.yml.

## Part 1. Implementation

Использование:

- очередь на обработку задачи. Человек подходит к терминалу и и терминал вызывает POST /task запрос на получение номера в очереди. Получая объект задачи.
- Оператор получает следующую WAITING задачу в очереди вызывая GET  /task
- Оператор меняет статус обработки задачи по номеру задачи PATCH /task/number
- Оператор может удалять задачу по номеру задачи DELETE /task/number
- На экране показывается разбивка задач по статусам кроме завершенных TaskStatus GET /tasks.

Объекты:

  ```JSON
    Task {
      number,
      status,
      times: [status: time] 
    }
  ```

  ```JSON
    TaskStatus {
      status :[number] 
    }
  ```

Пользователь:

- Статусы:
  `NEW` -> `WAITING` ->  `PROCESSED` -> `CLOSE`.
  Статус в который может перейти любая задача `CANCEL`. Можно переводить задачу на шаг назад по статусу и на шаг вперед. Задача из статуса `PROCESSED` переведенная в `WAITING` ставится в конец очереди.
- Номер:
  Уникальная строка из нескольких цифр и букв
  Использовать для очередей реализации `ConcurrentLinkedQueue`
- Время:
  Время обработки задачи в миллисекундах

Менеджер:

- Менеджер может посмотреть среднее время обработки по задачам /times
- Менеджер может посмотреть время обработки по задаче /times/number
- Менеджер может посмотреть время обработки по статусу задачи /times/number/status
- Менеджер может посмотреть среднее время обработки по статусам  /times/status

> В проекте использовать mapStruct swagger lombok. Обеспечить покрытие выше 90%
> Задачи лежащие в статусе кроме NEW дольше 30 минут при проверке раз в минуту по cron  переходят в статус CANCEL

## Part 2. Bonus

- +1 бал Для проекта оформить swagger.yml и реализовать контракт first
- +1 бал реализовать SOAP service
- +1 бал реализовать grpc
- +1 бал [реализовать SecurityFilterChain](https://docs.spring.io/spring-security/reference/servlet/configuration/java.html) с доступом к endpoint-ами на создание и получение списка задач в очереди permitAll, а к остальным по ролям "manager", "user" с паролем и логином хранящемся в application.properties или env переменной. И покрыть тестами данное поведение.
